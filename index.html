<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Card√°pio</title>
<style>
  :root {
    --bg:#fafafa;
    --ink:#111;
    --muted:#666;
    --line:#e6e6e6;
  }

  * { box-sizing: border-box; }
  body {
    margin: 0;
    background: var(--bg);
    color: var(--ink);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }

  header {
    position: sticky;
    top: 0;
    background: #fff;
    border-bottom: 1px solid var(--line);
    padding: 12px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    z-index: 10;
  }

  .brand { display: flex; gap: 12px; align-items: center; }
  .info { font-size: .9rem; color: var(--muted); }
  .cart-btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    border: 1px solid var(--line);
    padding: 8px 12px;
    border-radius: 999px;
    text-decoration: none;
    color: var(--ink);
    background: #fff;
    transition: transform .3s ease;
  }
  .cart-count {
    min-width: 20px;
    height: 20px;
    border-radius: 999px;
    border: 1px solid var(--line);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: .8rem;
  }
  main {
    max-width: 900px;
    margin: 0 auto;
    padding: 16px;
  }
  h2 { margin: 24px 0 8px; font-size: 1.3rem; }

  .grid {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 8px 12px;
    background: #fff;
    border: 1px solid var(--line);
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 10px;
  }
  .item-name { font-weight: 600; }
  .item-price { color: var(--muted); text-align: right; }
  .add {
    justify-self: end;
    padding: 8px 12px;
    border-radius: 8px;
    border: 1px solid var(--line);
    background: #fff;
    cursor: pointer;
    font-size: .95rem;
  }
  .add:active { background: #f2f2f2; }
  .muted { color: var(--muted); font-size: .9rem; }

  @keyframes shake {
    0%,100% { transform: translateX(0); }
    20% { transform: translateX(-4px); }
    40% { transform: translateX(4px); }
    60% { transform: translateX(-3px); }
    80% { transform: translateX(3px); }
  }
  .shake { animation: shake 0.4s ease; }

  /* Popup quantidade */
  .overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 999;
  }
  .popup {
    background: #fff;
    border-radius: 16px;
    padding: 20px;
    width: 90%;
    max-width: 340px;
    text-align: center;
  }
  .popup h3 { margin-bottom: 12px; font-size: 1.1rem; }
  .qty-controls {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    margin: 12px 0;
  }
  .qty-controls button {
    width: 46px; height: 46px;
    font-size: 1.4rem;
    border: none;
    background: #111; color: #fff;
    border-radius: 10px;
    cursor: pointer;
  }
  .qty-value { font-size: 1.6rem; font-weight: 700; }
  .popup-actions {
    display: flex;
    justify-content: space-between;
    gap: 10px;
    margin-top: 10px;
  }
  .popup-actions button {
    flex: 1;
    padding: 12px;
    font-size: 1rem;
    border: none;
    border-radius: 10px;
    cursor: pointer;
  }
  .popup-actions .confirm { background: #111; color: #fff; }
  .popup-actions .cancel { background: #eee; color: #111; }

  @media (max-width: 600px) {
    main { padding: 12px; }
    h2 { font-size: 1.1rem; }
    .grid { grid-template-columns: 1fr; gap: 6px; }
    .add { width: 100%; text-align: center; padding: 10px; font-weight: 600; }
    .item-price { text-align: left; }
  }
</style>
</head>
<body>
  <header>
    <div class="brand">
      <div><strong>Seu Caf√©</strong></div>
      <div class="info" id="comandaInfo"></div>
    </div>
    <a id="cartLink" class="cart-btn" href="#">
      <span id="cartEmoji">üõí</span>
      <span class="cart-count" id="cartCount">0</span>
    </a>
  </header>

  <main>
    <p class="muted">Escolha os itens e adicione ao carrinho. Depois, finalize na p√°gina do carrinho.</p>

    <section>
      <h2>P√£es</h2>
      <div id="list-paes"></div>
    </section>

    <section>
      <h2>Caf√©s</h2>
      <div id="list-cafes"></div>
    </section>

    <section>
      <h2>Caf√©s Gelados</h2>
      <div id="list-gelados"></div>
    </section>

    <section>
      <h2>Waffles</h2>
      <div id="list-waffles"></div>
    </section>
  </main>

<script>
const MENU = {
  paes: [
    { id:"pao-chapa", nome:"P√£o na chapa (Manteiga Serra Mineira)", preco:4.00 },
    { id:"pao-ovo", nome:"P√£o com ovo", preco:6.00 },
    { id:"pao-requeijao", nome:"P√£o com requeij√£o (crostinha)", preco:7.00 },
    { id:"pao-julieta", nome:"P√£o com requeij√£o e goiabada (crostinha julieta)", preco:8.00 },
    { id:"pao-nutella", nome:"P√£o com Nutella", preco:10.00 },
  ],
  cafes: [
    { id:"espresso-curto", nome:"Espresso (curto) (~50 ml)", preco:3.00 },
    { id:"espresso-longo", nome:"Espresso (longo) (~100 ml)", preco:6.00 },
    { id:"cappuccino", nome:"Cappuccino (~280 ml)", preco:10.00 },
    { id:"latte", nome:"Latte (~280 ml)", preco:9.00 },
    { id:"mocha", nome:"Chocolate Mocha (~280 ml)", preco:10.00 },
  ],
  gelados: [
    { id:"shake-doce-de-leite", nome:"Shake caf√© gelado doce de leite (~400 ml)", preco:0 },
    { id:"shake-avela", nome:"Shake caf√© gelado Avel√£ (~400 ml)", preco:0 },
  ],
  waffles: {
    titulo: "Waffle",
    itens: [
      { id:"waffle-mexerica", nome:"Gel√©ia de mexerica", preco:14.00 },
      { id:"waffle-figo", nome:"Gel√©ia de figo, laranja e canela", preco:14.00 },
      { id:"waffle-silvestres", nome:"Gel√©ia de frutas silvestres com aceto bals√¢mico", preco:14.00 },
    ]
  }
};

const params = new URLSearchParams(location.search);
const CMD = params.get("cmd") || "default";
const storeCartKey = (cmd)=> `cart_for_cmd_${cmd}`;
let cart = loadCart();

function loadCart(){ try { return JSON.parse(localStorage.getItem(storeCartKey(CMD))) || []; } catch { return []; } }
function saveCart(){ localStorage.setItem(storeCartKey(CMD), JSON.stringify(cart)); }
function money(n){ return n.toLocaleString("pt-BR",{minimumFractionDigits:2, maximumFractionDigits:2}); }
function updateBadge(){
  const c = cart.reduce((s,i)=> s + i.qtd, 0);
  document.getElementById("cartCount").textContent = c;
}
function shakeCart(){
  const cartEl = document.getElementById('cartLink');
  cartEl.classList.add('shake');
  setTimeout(()=> cartEl.classList.remove('shake'), 400);
}

function showQuantityPopup(item, fullName){
  const overlay = document.createElement('div');
  overlay.className = 'overlay';
  const popup = document.createElement('div');
  popup.className = 'popup';
  popup.innerHTML = `
    <h3>${fullName}</h3>
    <div class="qty-controls">
      <button id="minus">‚Äì</button>
      <span class="qty-value" id="qtyValue">1</span>
      <button id="plus">+</button>
    </div>
    <div class="popup-actions">
      <button class="cancel" id="cancelBtn">Cancelar</button>
      <button class="confirm" id="confirmBtn">Confirmar</button>
    </div>
  `;
  overlay.appendChild(popup);
  document.body.appendChild(overlay);

  let qty = 1;
  const qtyValue = popup.querySelector('#qtyValue');
  popup.querySelector('#minus').onclick = ()=> { if(qty>1){ qty--; qtyValue.textContent=qty; } };
  popup.querySelector('#plus').onclick = ()=> { qty++; qtyValue.textContent=qty; };
  popup.querySelector('#cancelBtn').onclick = ()=> overlay.remove();
  popup.querySelector('#confirmBtn').onclick = ()=>{
    const found = cart.find(x=>x.id===item.id);
    if(found){ found.qtd += qty; }
    else { cart.push({ id:item.id, nome:fullName, preco:item.preco, qtd:qty }); }
    saveCart(); updateBadge(); shakeCart();
    overlay.remove();
  };
}

function renderList(containerId, items){
  const el = document.getElementById(containerId);
  el.innerHTML = "";
  if(!Array.isArray(items)){
    items.itens.forEach(item=>{
      const row = document.createElement('div');
      row.className = "grid";
      const name = document.createElement('div');
      name.className = "item-name";
      name.textContent = `${items.titulo} ‚Äî ${item.nome}`;
      const right = document.createElement('div');
      right.style.display = "flex";
      right.style.alignItems = "center";
      right.style.gap = "8px";
      const price = document.createElement('div');
      price.className = "item-price";
      price.textContent = "R$ " + money(item.preco);
      const btn = document.createElement('button');
      btn.className = "add";
      btn.textContent = "+ Adicionar";
      btn.onclick = ()=> showQuantityPopup(item, `${items.titulo} ‚Äî ${item.nome}`);
      right.append(price, btn);
      row.append(name, right);
      el.append(row);
    });
    return;
  }
  items.forEach(item=>{
    const row = document.createElement('div');
    row.className = "grid";
    const name = document.createElement('div');
    name.className = "item-name";
    name.textContent = item.nome;
    const right = document.createElement('div');
    right.style.display = "flex";
    right.style.alignItems = "center";
    right.style.gap = "8px";
    const price = document.createElement('div');
    price.className = "item-price";
    price.textContent = "R$ " + money(item.preco);
    const btn = document.createElement('button');
    btn.className = "add";
    btn.textContent = "+ Adicionar";
    btn.onclick = ()=> showQuantityPopup(item, item.nome);
    right.append(price, btn);
    row.append(name, right);
    el.append(row);
  });
}

document.getElementById("comandaInfo").textContent = "Comanda " + CMD;
document.getElementById("cartLink").href = `carrinho.html?cmd=${encodeURIComponent(CMD)}`;
renderList("list-paes", MENU.paes);
renderList("list-cafes", MENU.cafes);
renderList("list-gelados", MENU.gelados);
renderList("list-waffles", MENU.waffles);
updateBadge();
</script>
</body>
</html>

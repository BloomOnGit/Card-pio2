<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Carrinho</title>
<style>
  :root{--bg:#fafafa;--ink:#111;--muted:#666;--line:#e6e6e6;--acc:#111;}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);padding:12px 16px;display:flex;align-items:center;justify-content:space-between;z-index:10}
  a{text-decoration:none;color:inherit}
  .mesa{font-weight:700}
  main{max-width:900px;margin:0 auto;padding:16px}
  .row{display:grid;grid-template-columns:1fr auto auto;gap:8px 12px;align-items:center;padding:12px 0;border-bottom:1px solid var(--line);background:#fff}
  .muted{color:var(--muted)}
  .chip{border:1px solid var(--line);border-radius:999px;padding:4px 8px;background:#fff;cursor:pointer}
  .qty{display:inline-flex;gap:8px;align-items:center}
  .totals{display:flex;justify-content:space-between;align-items:center;padding:16px 0}
  .btn{display:inline-block;padding:12px 16px;border-radius:10px;border:none;background:var(--acc);color:#fff;font-weight:700;text-align:center;cursor:pointer}
  .btn.sec{background:#fff;color:var(--ink);border:1px solid var(--line)}
  .card{background:#fff;border:1px solid var(--line);border-radius:12px;padding:12px}
  textarea{width:100%;min-height:120px;padding:10px;border:1px solid var(--line);border-radius:8px}
</style>
</head>
<body>
  <header>
    <a id="backLink" href="#">‚Üê Voltar</a>
    <div class="mesa" id="mesaLabel">Mesa ‚Äî</div>
  </header>

  <main>
    <h1 style="margin:8px 0 12px">Seu carrinho</h1>
    <div id="cartList" class="card"></div>

    <div class="totals">
      <div class="muted">Itens: <span id="count">0</span></div>
      <div><strong>Total: R$ <span id="total">0,00</span></strong></div>
    </div>

    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn sec" id="clearCart">Limpar carrinho</button>
      <button class="btn" id="sendOrder">Enviar pedido</button>
    </div>

    <div id="copyBox" style="display:none;margin-top:12px">
      <p class="muted" style="margin:8px 0">Mensagem copiada. Se preferir, voc√™ pode colar onde quiser:</p>
      <textarea id="preview" readonly></textarea>
    </div>
  </main>

<script>
/* ------- ESTADO / STORAGE ------- */
const params = new URLSearchParams(location.search);
const MESA = params.get("mesa") || "‚Äî";
const STORE_KEY = "cafe_cart_v1";
let cart = loadCart();

function loadCart(){ try { return JSON.parse(localStorage.getItem(STORE_KEY)) || []; } catch { return []; } }
function saveCart(){ localStorage.setItem(STORE_KEY, JSON.stringify(cart)); }
function money(n){ return n.toLocaleString("pt-BR",{minimumFractionDigits:2, maximumFractionDigits:2}); }

/* ------- A√á√ïES DO CARRINHO ------- */
function removeOne(id){
  const idx = cart.findIndex(x=>x.id===id);
  if(idx>=0){
    cart[idx].qtd -= 1;
    if(cart[idx].qtd<=0) cart.splice(idx,1);
    saveCart(); render();
  }
}
function addOne(id){
  const item = cart.find(x=>x.id===id);
  if(item){ item.qtd += 1; saveCart(); render(); }
}
function removeAll(id){
  cart = cart.filter(x=>x.id!==id);
  saveCart(); render();
}
function clearCart(){
  cart = []; saveCart(); render();
}

/* ------- RENDER ------- */
function totalCart(){ return cart.reduce((s,i)=> s + i.preco*i.qtd, 0); }
function countCart(){ return cart.reduce((s,i)=> s + i.qtd, 0); }

function render(){
  document.getElementById("mesaLabel").textContent = "Mesa " + MESA;
  document.getElementById("backLink").href = "index.html?mesa=" + encodeURIComponent(MESA);

  const list = document.getElementById("cartList");
  list.innerHTML = "";

  if(cart.length===0){
    list.innerHTML = '<p class="muted">Seu carrinho est√° vazio.</p>';
  } else {
    cart.forEach(i=>{
      const row = document.createElement('div');
      row.className = "row";

      const name = document.createElement('div');
      name.innerHTML = `<strong>${i.nome}</strong><br><span class="muted">R$ ${money(i.preco)}</span>`;

      const qty = document.createElement('div');
      qty.className = "qty";
      const btnMenos = document.createElement('button'); btnMenos.className="chip"; btnMenos.textContent="‚Äì";
      const spanQtd  = document.createElement('span');  spanQtd.textContent = i.qtd;
      const btnMais  = document.createElement('button'); btnMais.className="chip"; btnMais.textContent="+";
      btnMenos.onclick = ()=> removeOne(i.id);
      btnMais.onclick  = ()=> addOne(i.id);
      qty.append(btnMenos, spanQtd, btnMais);

      const del = document.createElement('button');
      del.className="chip"; del.textContent="Remover";
      del.onclick = ()=> removeAll(i.id);

      row.append(name, qty, del);
      list.append(row);
    });
  }

  document.getElementById("total").textContent = money(totalCart());
  document.getElementById("count").textContent = countCart();
}

document.getElementById("clearCart").onclick = clearCart;

/* ------- ENVIAR (sem Telegram, s√≥ copia) ------- */
document.getElementById("sendOrder").onclick = async ()=>{
  if(cart.length===0){ alert("Seu carrinho est√° vazio."); return; }

  // Monta texto leg√≠vel
  const linhas = cart.map(i=>`‚Ä¢ ${i.nome} x${i.qtd} ‚Äî R$ ${money(i.preco*i.qtd)}`).join('\n');
  const msg =
`üßæ Pedido
Mesa: ${MESA}

${linhas}

Total: R$ ${money(totalCart())}`;

  // Copia p/ clipboard
  try {
    await navigator.clipboard.writeText(msg);
    document.getElementById("copyBox").style.display = "block";
    document.getElementById("preview").value = msg;
    alert("Pedido copiado para a √°rea de transfer√™ncia!");
  } catch {
    // fallback: mostra na caixinha para copiar manual
    document.getElementById("copyBox").style.display = "block";
    document.getElementById("preview").value = msg;
  }
};

render();
</script>
</body>
</html>
